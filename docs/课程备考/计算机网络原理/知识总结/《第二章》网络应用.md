# 内容概括：

1. 计算机网络应用体系结构
2. 网络应用通信基本原理
3. 域名系统（DNS）
4. 万维网应用
5. Internet电子邮件
6. FTP
7. P2P应用
8. Socket编程基础

## 1.计算机网络应用体系结构
计算机网络应用是运行在计算机网络环境下的分布式软件系统，从体系结构角度可以分为： `客户/服务器(C/S)结构` `纯P2P结构` `混合结构`


1. 客户/服务器(C/S)结构网应用
这个应用是网络应用中最典型，最基本的网络应用，人们平时使用的许多网络应用都属于这类应用，比如WWW应用，文件传输FTP，电子邮件等。
在C/S网络应用中，服务器通常运行在高性能的服务器计算机上。服务器计算机一般具有固定的网络地址（比如IP地址） 长期运行，以便服务器软件能够随时被请求服务。客户软件通常在普通用户的计算机或者其他计算设备上，可能使用动态的网络地址，是通信的主动发起方。
C/S网络应用最主要的特征是通信只在客户与服务器之间进行，客户与客户之间不进行直接通信。在现代计算机网络中，网络应用程序之间通信的基本模式就是C/S方式通信。在C/S通信过程中，主动发起通信的一方就是客户，被动接受通信的一方就是服务器

2. 纯P2P结构网络应用
在用于文件分发，文件共享，视频流服务等应用中，P2P应用表现出优越的性能。在纯P2P网络应用中，没有一直在运行的传统服务器，所有通信都是在对等的通讯方之间直接进行，通信双发没有传统意义上的客户与服务器之分，“地位”对等 对等端软件通常运行在普通用户的计算设备上，可以动态地直接与其他对等端进行通信。P2P应用中每个对等端都同时具备C/S应用的客户与服务器的特征，是一个服务器与客户的结合体。P2P应用中的对等端软件包括服务器软件和客户端软件
在P2P应用中，对等端都是动态加入或者离开应用，新加入对等端需要知道有哪些对等端在线，在线对等端的地址以及在线对等端提供的服务器等，这是P2P应用需要解决的关键问题之一，对于纯P2P应用，由于没有中心服务器，所以解决这些问提就更为困难和复杂

3. 混合结构网络应用
顾名思义，就是C/S 和 P2P 的应用相结合，既有中心服务器的存在，又有对等端的直接通信，通常每个客户通过C/S方式向服务器注册自己的网络地址，声明自己可以共享的资源或可提供的服务，并通过中心服务器发现其他在线客户，检索其他客户可以共享的资源以及服务，当某客户希望获取另外一个客户拥有的资源或服务时，直接跟客户发起通信，请求服务区


## 2.网络应用通信基本原理
本质是运行在不同主机上的应用进程之间的通信。无论是哪种类型的网络应用，基本通信方式都是C/S通信，因此，网络应用的基本通信过程就是在不同运行在不同主机上的应用进程间以C/S方式进行的通信。应用进程间遵循应用层协议交换应用层报文，应用层协议定义了应用进程之间交换报文类型，报文构成部分具体含义以及交换时序等内容即语法 语义 时序

典型的网络应用编程接口是套接字（Socket）应用进程通过创建Socket实现与底层协议接口，进一步通过Socket实现应用进程与底层协议的报文交换，因此Socket是每个应用程序与其他应用程序进行网络通信时真正收发报文的通道
一个应用进程可以创建多个Socket与同一个或不同的传输层协议进行接口，通常会对其接口每个Socket分配一个编号——`端口号`, 通常服务器进程Socket会分配特定端口号，尤其是标准化应用，比如Web是80，这种成为熟知端口号，因为主机可以运行多个进程，而进程可以通过一个或者多个Socket与传输层进行接口，所以可以主机IP跟端口号可以表示应用进程

网络应用需要传输层提供端到端的服务，应用对传输层有不同的服务性能要求，例如：提供可靠的数据传输服务，提供延时保障服务，但是在Internet中传输层能够提供的服务类型只有两类：面向连接的可靠字节流传输服务和无连接的不可靠数据报传输服务，分别对应传输层TCP和UDP，这两类都不能提供延时保障服务和带宽保障服务

TCP服务模型包括面向连接服务和可靠数据传输服务：
- 面向连接的服务：在应用层开报文开始传送之前，TCP客户与服务器互相交换传输层控制信息，完成握手，在客户进程与服务器进程的Socket之间建立一条逻辑的TCP全双工 连接，当应用程序结束报文传送后，必须拆除改 连接
- 可靠的数据传送服务：应用程序能够依靠TCP，实现端到端的无差错，按顺序交付所有发送数据的服务

UDP是一种不提供传输服务保障的轻量级传输层协议，UDP是无连接的，因此进程在通信前没有握手过程，UDP提供一种不可靠的数据传送服务，也就是说，当进程将一个报文通过UDP Socket传送时，UDP并不保证该报文将到达接收进程，即使到达，报文也可能是乱序到达

特别注意的是，InTernet传输层的TCP和UDP均不能提供端到端吞吐量以及时延保障服务


## 3.域名系统（DNS）
用户通过客户端软件访问网络应用（浏览器，邮件），这些客户端软件成为`用户代理`，用户习惯用主机的`域名`来代替IP地址访问服务器，而DNS就是将域名解析成IP的系统，成为`域名系统(DNS)`。`DNS`是一个重要的基础应用，任何一个需要使用域名进行通信的网络应用，在通信前都要请求DNS应用，将域名映射为IP地址，实现将域名映射为IP地址的过程成为 `域名解析`。 DNS为了实现域名解析，需要建立分布式数据库，存储网络中域名与IP的映射关系，这些数据库存储在域名服务器上，域名服务器根据用户的请求提供域名解析服务

1. 层次化域名空间
   DNS服务器按层次结构进行组织，与于域名的结构相对应。因特网词用层次树状结构的命名方法，任何一个连接在因特网的主机或路由器都可以有一个唯一的层次结构域名。域名的结构由标号序列组成，各标号用点隔开
   - 国家顶级域名nTLD 如 cn us uk
   - 通用顶级域名gTLD 如 com（公司） net（网络服务机构） org（非盈利性组织） edu（专用教育机构） gov（专用政府部门） mil（专用军事部门） int（国际组织）
   - 基础结构域名：这种顶级域名只有一个 arpa 用户反向域名解析，也称为反向域名s

2. 域名服务器
  一个服务器所负责管辖的范围叫区。每一个区设置相对应的权限域名服务器，用来保存该区中所有主机的域名到IP地址的映射，域名服务器根据其保存的域名信息以及域名解析过程中的作用等可以分为 `根域名服务器` `顶级域名服务器` `权威域名服务器` `中间域名服务器`  一般主机都会配置一个域名服务器作为域名解析首先被查询的域名服务器，成为本地域名服务器

  - 根域名服务器：最重要的域名服务器，每个根域名服务器都知道所有的顶级域名服务器的IP地址，只要哪个本地域名服务器无法对一个域名进行解析就首先求助于根域名服务器，一共有13个域名不同IP地址的根域名服务器 (a-m).rootservers.net 
  - 顶级域名服务器：即TLD服务器，负责管理在该顶级域名服务器注册的所有二级域名。顶级域名服务器的名称对应域名的最后一个名字，例如 com org 或者一个区域的命名 cn us
  - 权威域名服务器：负责一个区的域名服务器，保存该区的所有主机的域名到IP地址映射，任何一个拥有域名的主机，其域名跟IP的映射关系等信息都会存储在所在网络的权威域名服务器上
  - 中间域名服务器： 即不是根域名服务器，顶级域名服务器，也不是权威域名服务器的域名服务器，这些域名服务器称为中间域名服务器 例如主机域名为www.abc.xyz.com

3. 域名解析过程
分为递归解析和迭代解析，提供递归查询的域名服务器可以代替查询主机或者其他域名服务器，进行进一步域名查询，然后把解析结果发送给查询主机或服务器，而迭代查询服务器不会这样，只是进一步的查询，然后把下一步要查询的服务器告知主机或服务器

- 递归解析 通常本地域名服务器都有该查询服务，域名查询时，如果本地域名服务器没有查询到，则代理主机查询根域名服务器或其他服务器，知道得到查询结果，最后将解析结果发送给主机
- 迭代解析 如果得到结果直接响应，没有的话就将下一步要查询的域名服务器直接响应给查询客户，根域名服务器通常指提供迭代查询服务，当根域名服务器收到本地域名服务器的迭代查询请求报文时，要么直接给出所要查询的IP地址，要么在响应报文中告诉本地域名服务器下一步应当查询哪一个域名服务器
  
无论哪种解析，只要本地域名服务器不能直接响应结果，则都需要从根域名服务器开始查询，但是由于根域名服务器数量有限，如果每次都去查询则压力会很大，造成查询时间长和查询效率低，所以域名服务器会增加缓存机制，或者在本地域名服务器中存储顶级域名服务器信息，使得域名解析过程跳过根域名服务器的查询，直接查询顶级服务器，提高域名查询效率

## 4.万维网应用
  1. 应用结构
     万维网也称为Web应用，主要包括web服务器，浏览器和超文本传输协议HTTP 等部分，浏览器就是Web应用的客户端软件，Web服务器就是Web应用的服务器软件，客户与服务器之间的交互基于应用层协议HTTP。Web页面是由对象组成的，例如HTML文件，JPEG文件，视频文件，JAVA小程序等。在Web应用中，通过URL地址来寻找一个WEb页，每个URL地址主要由两部分组成，服务器主机域名（或IP地址）和对象的路径名。URL寻址方式确保万维网的每个Web页或对象有一个唯一的标识符.

  2. HTTP
     HTTP 是Web应用的应用层协议，定义浏览器如何向Web服务器发送请求以及Web服务器如何向浏览器进行响应。目前主要使用HTTP/1.0 和 HTTP/1.1两个版本

     - HTTP历史：HTTP1.0相比上一个版本增加了协议版本号，各种首部行，额外的方法以及对多媒体对象的支持，表单，增加了交换能力，HTTP/1.0+ 相比上个版本加了很多特性，比如持久的keep-alive链接，虚拟主机支持以及代理链接支持等，最新的HTTP/1.1版本是目前Web应用最广泛的HTTP版本。相比上个版本支持更多的请求方法，拓展了一些首部，增加了响应状态码，改进了对缓存的支持等。重点是矫正了HTTP设计中的结构缺陷，明确了语义，引入了重要的性能优化措施，并删除了一些不良特性。
     - HTTP连接：基于传输层的TCP传输报文，先建立TCP连接再发送HTTP请求报文，接收HTTP响应报文，根据TCP连接策略不同分类`持久链接` 跟 `非持久连接`
       - 非持久连接：指HTTP客户跟HTTP服务器建立TCP连接后，通过该连接发送HTTP请求报文，接收HTTP响应报文，然后断开链接。HTTP/1.0默认使用非持久连接，每次请求传输一个对象都要新建立一个TCP链接
       - 并行链接：为了提供改善HTTP的性能，通过建立多条并行的TCP连接，并行发送HTTP请求和并行接收HTTP响应
       - 持久链接： 重用已建立的TCp连接发送新的HTTP请求和接收hTTP响应，从而消除新建TCP链接的时间开销

     - HTTP报文
        HTTP报文由4部分组成 `起始行` `首部行` `空白行` `实体主体`, 起始行与首部是行为分割的ASCII文本，每行由CRLF（回车换行）终止，空白行只有CRLF，主体可以是文本或二进制数据。HTTP报文起始行和空白行不可缺少，首部行可以是零行或多行，实体主体根据报文类型，功能等可有可无
        HTTP报文可以分为两类：请求报文跟响应报文，请求报文由浏览器发送给WEb服务器，响应报文由Web服务器发送给服务器，请求报文与响应报文最大的区别就是起始行不同：
        请求报文起始行： <方法><URL><协议版本>
        响应报文起始行： <协议版本><状态码><短语>

        其中方法表示客户端希望服务器对URL指定的资源执行的操作或动作，URL表示定时所请求的资源，协议版本代表HTTP版本号，格式为HTTP/主版本号.此版本号
        HTTP典型的请求方法有GET，HEAD，POST，OPTION，PUT等
        - GET：请求读取由URL所标识的信息
        - HEAD：请求读取由URL标识的信息的首部，无需在响应报文中包含对象
        - POST：给服务器添加信息
        - OPTION：请求一些选项的信息
        - PUT：在指名URL下存储一个文档

      HTTP状态码分类:
        - lxx 100~199 信息提示  通告信息，可能还需要进一步交互
        - 2xx 200~299 成功  成功完成客户请求的操作，并进行响应
        - 3xx 300~399 重定向  表示资源已移走，需要向新URL发请求
        - 4xx 400~499 客户端错误  由于客户端请求错误，无法成功响应
        - 5xx 500~599 服务器端错误  由于服务器端错误，无法成功响应\
      常见的HTTP状态码:
        - 100 表示已成功收到请求的初始部分，请客户端继续
        - 200 成功，所请求信息在响应报文中
        - 300 重定向，所请求对象被永久一走，在响应报文的首部行Location：中会给出新的URL，通常浏览器会自动想新URL发送请求
        - 400 客户端请求错误，服务器不能正确理解客户请求
        - 401 未授权，需要输入用户名跟密码
        - 404 客户端请求的对象在服务器上不存在
        - 451 不支持的媒体类型，可能被服务器拒绝请求，或者是请求方法或者是参数与服务器要求不匹配
        - 505 请求使用的HTTP版本，服务器不支持
        - 
  3. COOKIE
     HTTP不保存客户的状态信息，所以HTTP被称为无状态协议。由于HTTP是一种无状态协议，因此客户端与服务器一单数据交换完毕，连接就会断开，再次进行数据交换就需要建立新的连接需要新的身份认证，所以Web应用引入了Cookie机制，用于用户跟踪。COOKIE中文名称为小型文本文件，由服务端生成，发送给USer-Agent，浏览器会将Cookie的key/value保存到某个目录文本文件内，下次请求就发送该Cookie给服务端（需要浏览器启用Cookie），Cookie技术主要包括4部分内容：
     - HTTP响应报文中的Cookie头行：Set-Cookie。
     - 用户浏览器在本地存储，维护和管理Cookie文件
     - HTTP请求报文中的Cookie头行：Cookie
     - 网站在后台数据库中存储，维护Cookie信息

## 5.Internet电子邮件
  1. 电子邮件系统结构
     电子邮件系统主要包括邮件服务器，简单邮件传输协议SMTP，用户代理和邮件读取协议等
     - 邮件服务器：负责发送和接收邮件，同时向发信人报告邮件传送情况，是电子邮件体系结构的核心
     - 用户代理：电子邮件应用的客户端软件，为用户提供使用电子邮件的接口
     - SMTP：实现邮件服务器发送邮件的应用层协议，按照客户/服务器方式工作
     - 邮件读取协议：POP，IMAP等
  2. SMTP
     SMTP是Internet电子邮件中核心应用层协议，实现邮件服务器之间或用户代理到邮件服务器之间的邮件传输。SMTP使用传输层TCP实现可靠数据传输。STMP作为电子邮件系统的核心应用层协议，具有如下几个特点
     - STMP只能传送7位ASCII码文本内容，包括SMTP命令，应答消息以及邮件内容。因此STMP不能直接传送可执行文件或其他二进制对象，需先转换成7位ASCII码文本格式，接收邮件一方再还原
     - SMTP传送邮件内容不能包含`CRLF.CRLF` 因为该信息用于表示邮件内容的结束
     - STMP是 `推动` 协议
     - SMTP使用TCP链接是持久的
  3. 电子邮件格式与MIME
     一份邮件包括首部，空白行，主体3部分，其中常见首部行包括以下内容：
    - To：收件人电子邮件地址
    - Subject：邮件主题
    - Cc：表示应该某某人发送一个邮件副本
    - From：发信人的邮件地址
    - Date：发信日期
    - Reply-To，对方回信所用地址
    由于邮件只能传输7位ASCII码文本内容，所以在传输其他内容使需要用到MIME拓展将其转换然后再传输
  4. 电子邮件读取协议
    - POP3：简单的邮件读取协议，因此其功能有限，为了保证读取邮件过程的可靠性，POP3使用传输层TCP
    - IMAP：相比POP3不具备支持用户创建远程文件夹并为邮件指派文件夹功能，IMAP支持该特性，并且具有更多的特性，也比POP3更复杂
    - HTTP：HTTP是Web应用应用层的协议，当使用基于Web应用的邮件时，HTTP便用于邮件的读取，此时HTTP也作为邮件读取协议使用

## 6.FTP
  文件传输协议是在互联网两个主机间实现文件互传的网络应用，其应用层协议也称为FTP。FTP可以减少或消除在不同操作系统下处理文件的不兼容性，屏蔽各计算机系统的细节，适合在网络中任意异构计算机之间传送文件。FTP是典型的客户/服务器网络应用，采用C/S凡是实现客户与服务器之间的双向文件传输。使用TCP的可靠传输服务

  FTP是有状态的协议，FTP控制信息的传送方式成为带外控制。应用层协议成为带内控制协议

  FTP会话形式是客户向服务器发送命令，服务器发送状态码和短语应答，都是由7位ASCII码格式在控制连接上传送的，因此FTP命令和应答都是可读，每个FTP命令由4个大写字母ASCII字符组成，有些命令还带有参数。一些较为常见的命令如下：
   - USER username， 用于向服务器传送用户标识
   - PASS password，用于向服务器发送用户口令
   - LIST 请求服务器返回远程目录所有文件列表
   - RETR filename 从FTP服务器下载文件
   - STOR filename，用于向服务器上传文件
   - 331 Username OK， Password required
   - 125 Data connection already open;transfer starting
   - 425 Cant'open data connection

## 7.P2P应用
客户/服务器体系结构应用的关键在于服务器，服务器必须一直处于运行状态，一旦服务器出现故障，则整个应用瘫痪，这就是所以`单点故障问题` 客户/服务器结构应用中的服务器性能，服务器接入网络带宽等，在很大程度上决定了应用性能，应用规模以及用户体验，而P2P体系结构网络则不同，对服务器依赖很小，可以说几乎不依赖某个集中服务器，应用都是动态的在对等方之间进行。在P2P应用中，对等方可以随时加入随时离开，具有很强的应用规模伸缩性。P2P应用充分聚集利用了端系统的计算能力以及网络传输带宽，代表的全新的网络应用架构与理念

在实现文件分发应用中，P2P体系结构应用远远优于客户/服务器体系结构应用，原因是在P2P应用中，每个对等方即是数据的获取者又是数据的提供者，P2P应用充分聚集和利用了每个对等方接入链路的上行宽带以及每个对等方的处理能力， 这正是大部分P2P应用的理念

## Socket编程基础
网络应用程序有两类：实现标准协议的网络应用和专用网络应用。网络应用的应用层协议遵循某个或某些规则，如RFC定义的标准或某种其他标准。专用网络应用是针对某组织或个人的特殊需求编写的网络应用程序，这类应用的应用层协议是专门设计的，没有公开发布在RFC中，没有成为标准，只在小范围内甚至只在某个网络应用中使用

网络应用进程通信时需要通过API接口请求底层协议的服务，如传输层服务，目前在Internet中应用最广泛的网络应用编程接口即使Socket API。

网络应用进程可以创建三种类型的Socket：`数据报类型套接字SOCK_DGRAM` `流式套接字SOCK_STREAM` `原始套接字SOCK_RAW` 其中SOCK_DGRAW面向传输层UDP接口，SOCK_STREAM面向传输层TCP接口，SOCK_RAW面向网络层协议接口。其中SOCK_RAW比较特殊，绕过了传输层，面向网络层接口，原始套接字的创建有权限控制

Socket为开发人员提供了开发C/S网络应用的途径与机构，具体形式为一组Socket API函数，典型的Socket API 函数如下：
1. ini socket(int family, int type, int protocol): 创建套接字， 参数1是协议族（PF_INET。AF_INET） 参数2是类型 参数3是协议
2. int close(int sockfd) 关闭指定SockFd套接字
3. int bind(int sockfd, const struct sockaddr\*myaddr,socklen_t addrelen) 绑定套接字的本地端点地址
4. int listen(int sockfd int backlog) 置服务器的流（TCP）套接字sockfd为监听状态
5. int connect(int sockfd const struct sockaddr\*servaddr, socklen_t addrlen) 将客户套接字sockfd与服务器连接
6. int accept(int sockfd,struct sockaddr\*cliaddr,socklen_t addrlen) 从监听状态的流套接字 sockfd的客户连接请求队列中，取出排在最前的客户一个请求，并且创建一个新的套接字来与客户套接字建立TCP连接
7. ssize_t send(int sockfd, const void \*buff, size_t nbytes,int flags) 发送数据 TCP套接字调用send()函数发送数据；也可以用于调用了connect()函数的客户端UDP套接字
8. ssize_t sendto(int sockfd,const void \*buff,size_t nbytes,int flags, const struct sockaddr\*to, socklen_t addrlen) 发送数据 用于UDP服务器端套接字或未调用connect()函数的UDP客户端套接字
9. ssize_t recv(int sockfd, void \*buff, size_t nbytes, int flags) 接收数据 用于从TCP套接字接收数据，也可以用于调用了connect()函数的UDP客户端套接字接受服务器发来的数据
10. ssize_t recvfrom(int sockfd, const void \*buff, size_t nbytes, int flags, struct sockaddr\*from,socklen_t addrlen) 接收数据 用于从UDP服务器端套接字或未调用connect()函数UDP客户端套接字接收数据
11. int setsockopt(int sockfd, int level, int optname, const void \*optval, socklen_t addrlen) 设置套接字选项
12. int getsockopt(int sockfd, int level, int optname, void\*optval, socklen_t addrlen) 读取套接字选项，用于获取任意类型，任意状态套接口的选项当前值，并把结果存入optval

在开发C/S架构网络应用程序时，根据应用特点和需求可以选择传输层TCP或UDP。 TCP提供面向连接，可靠的字节流传输服务。选择使用TCP的网络应用程序，无须处理数据丢失等问题，简单调用流程如下：

- 服务器程序运行 =》 调用socket()函数创建SOCK_STREAM类型主套接字ms =》 调用bind()函数绑定本端地址 =》 调用listen()函数置套接字ms为监听模式 =》 调用accept()函数通过主套接字ms接收客户端连接请求，并阻塞服务器进程 =》 accept()函数调用成功 返回连接套接字ss =》 调用close()函数释放套接字ss关闭TCP连接

- 客户程序运行 =》 创建本地SCOK_STREAM类型套接字cs =》 调用connect()函数请求与服务器TCP连接，connect()函数调用成功，表明TCP连接建立成功 =》 通过调用send()和recv()函数，实现数据发送与接收 =》 调用close()函数释放套接字cs


UDP 提供无连接，不可靠数据报传输服务，选择使用UDP的网络应用程序，不能依靠UDP实现可靠数据传输。基于UDP客户与服务器的典型API函数调用过程：

- 服务器程序运行 =》 调用socket()函数创建SOCK_DGRAM类型的套接字ums =》 调用bind()绑定本地端点地址
- 客户端成型运行 =》 创建本地SOCK_DGRAM类型的套接字ucs =》 客户程序与服务端程序通过调用sendTo() 和 recvfrom()函数，实现数据发送与接收 =》 调用close函数释放套接字ucs


